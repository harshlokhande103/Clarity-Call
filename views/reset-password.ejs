<!-- views/reset-password.ejs -->
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Reset Password</title></head>
<body>
  <h2>Reset Password</h2>
  <form id="reset-form">
    <input id="newPassword" type="password" placeholder="New password" required />
    <input id="confirmPassword" type="password" placeholder="Confirm new password" required />
    <button type="submit">Reset</button>
  </form>

  <script>
    const params = new URLSearchParams(window.location.search);
    const resetToken = params.get('resetToken');

    document.getElementById('reset-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const newPassword = document.getElementById('newPassword').value;
      const confirm = document.getElementById('confirmPassword').value;
      if(newPassword !== confirm) return alert('Passwords do not match');

      try {
        const res = await fetch('/api/users/reset-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ resetToken, newPassword })
        });
        const data = await res.json();
        if(res.ok){
          alert('Password reset successful. Please login.');
          window.location.href = '/login';
        } else {
          alert(data.message || 'Error');
        }
      } catch(err) {
        console.error(err);
        alert('Server error');
      }
    });
  </script>
</body>
</html>
